name: License Header Check

on:
    push:
        branches: [main, develop]
    pull_request:
        branches: [main, develop]
    workflow_dispatch:

permissions: {}

jobs:
    license-header:
        name: Check License Headers
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 #v6.0.0

            - name: Check License Headers
              uses: apache/skywalking-eyes/header@61275cc80d0798a405cb070f7d3a8aaf7cf2c2c1 # main
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    license-header-fix:
        name: Fix License Headers (Create PR)
        runs-on: ubuntu-latest
        if: github.event_name == 'workflow_dispatch'

        steps:
            - name: Checkout repository
              uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 #v6.0.0
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}

            - name: Fix License Headers
              uses: apache/skywalking-eyes/header@61275cc80d0798a405cb070f7d3a8aaf7cf2c2c1 # main
              with:
                  mode: fix
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Create Pull Request
              uses: peter-evans/create-pull-request@22a9089034f40e5a961c8808d113e2c98fb63676 # v7.0.11
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
                  commit-message: "fix: add missing license headers"
                  title: "Fix missing license headers"
                  body: |
                      This PR automatically fixes missing license headers in the codebase.

                      Generated by license-headers workflow.
                  branch: fix/license-headers
                  delete-branch: true
